# Gnosis Deposit Contract Balance Calculator

This Node.js utility calculates the **internal debt** of the [Gnosis Beacon Deposit Contract](https://gnosisscan.io/address/0x0b98057ea310f4d31f2a452b414647007d1645d9).

Unlike Ethereum, **Gnosis Chain (GNO)** does not issue new tokens to reward validators. Rewards are covered directly by **GnosisDAO**, which periodically tops up the deposit contract.  
As validators claim or leave rewards unclaimed, the balance of this contract represents the current **net internal debt** owed by GnosisDAO to validators.

The utility is part of the [Stakers.space](https://stakers.space/gnosis-staking/deposit-contract-balance) monitoring suite.

---

## ðŸ”§ Features
- Fetches live validator balances and deposit contract balance.
- Calculates **claimed / unclaimed GNO** across all active validators.
- Computes the **internal debt** (difference between total validator holdings and deposit contract balance).
- Supports both **CLI execution** and **library import** (Promise-based API).
- Provides **human-readable** and **machine-readable (JSON/IPC)** outputs.

---

## ðŸ“‹ Prerequisites
- Node.js (v18+ recommended)
- Running and synchronized **Execution** and **Beacon** clients
- Required utility libraries:
  - [`beacon-api.js`](https://github.com/Stakers-space/staking-scripts/tree/main/libs/beacon-api)
  - [`execution-api.js`](https://github.com/Stakers-space/staking-scripts/tree/main/libs/execution-api)
  - [`http-request.js`](https://github.com/Stakers-space/staking-scripts/tree/main/libs/http-request)
  - [`load-from-process-arguments.js`](https://github.com/Stakers-space/staking-scripts/tree/main/libs/load-from-process-arguments)

---

## ðŸ“¦ Installation
- View the script
```
curl -o- https://raw.githubusercontent.com/Stakers-space/staking-scripts/refs/heads/main/tools/calculate-gnosis-deposit-contract-balance/calculate-gnosis-deposit-contract-balance.js
```
- Create `/srv/stakersspace_utils` directory, if does not exist yet
```
sudo mkdir /srv/stakersspace_utils
```
- Download the script to `/srv/stakersspace_utils` directory
```
sudo curl -o /srv/stakersspace_utils/calculate-gnosis-deposit-contract-balance.js https://raw.githubusercontent.com/Stakers-space/staking-scripts/refs/heads/main/tools/calculate-gnosis-deposit-contract-balance/calculate-gnosis-deposit-contract-balance.js
```
- Define service user `stakersspace` (if does not exists yet)
```
sudo useradd --system --no-create-home --shell /bin/false stakersspace
```
- Add `stakersspace` user into the group with NodeJs user (if not added yet)
```
sudo usermod -aG myserveruser stakersspace
```
- Set file ownership dfirectory
```
sudo chown -R stakersspace:stakersspace /srv/stakersspace_utils/calculate-gnosis-deposit-contract-balance.js
```

---

## ðŸš€ CLI Usage
```
node calculate-gnosis-deposit-contract-balance.js --beaconBaseUrl http://localhost:9596 --executionBaseUrl http://localhost:8545
```
Example CLI Output
```
Starting Gnosis Deposit Contract Balance calculation
â”œâ”€ beaconBaseUrl: http://localhost:9596
â”œâ”€ executionBaseUrl: http://localhost:8545
â”œâ”€â”€ Fetching latest epoch and validator data...
â”œâ”€â”€ Processing validator snapshot for head slot state...
â”œâ”€â”€ Contract balance: 307183.7587 GNO
â”œâ”€â”€ Validatorsâ€™ total GNO on beaconchain: 328981.2514 GNO
â”œâ”€â”€ Unclaimed validator rewards: 5864.9754 GNO
â””â”€â”€ Internal debt: -27662.4680 GNO
```

### ðŸ§© Library Usage
You can use this tool programmatically in another Node.js application:
- 1) as import
```
const { runCalculateGnosisDepositContractBalance } = require('/srv/stakersspace_utils/calculate-gnosis-deposit-contract-balance.js');

(async () => {
  const result = await runCalculateGnosisDepositContractBalance({
    beaconBaseUrl: 'http://localhost:9596',
    executionBaseUrl: 'http://localhost:8545',
  });

  console.log('Result:', result);
})();
```
- 2) as child process
```
const { fork } = require('child_process');

const child = fork('/srv/stakersspace_utils/calculate-gnosis-deposit-contract-balance.js', [
  '--beaconBaseUrl=http://localhost:9596',
  '--executionBaseUrl=http://localhost:8545'
]);

child.on('message', (msg) => {
  console.log('Received from child process:', msg);
});

child.on('exit', (code) => {
  console.log('Process exited with code', code);
});
```

### Detailed Output
There's a text based UI output as well as object-based output allowing connection of the util with other scripts.
- UI based output:
```
Starting check GNO balance in Gnosis Validators Deposit contract
â”œâ”€ beaconPort: 9596 from attached param
â”œâ”€ executionPort: 8545 from attached param
â”œâ”€â”€ Getting current Epoch number...
|   â””â”€â”€ Current epoch: 1207137
â”œâ”€â”€ Processing validators snapshot for head slot state...
â”œâ”€â”€ GNO balance in deposit contract: 307183758748738.56 (307183.75874873856 GNO)
|  â”œâ”€â”€ snapshot completed | registered validators: 464775
|  â””â”€â”€ Withdrawal addresses: 3502
|  â””â”€â”€ Total GNO balance holded by validators on beaconchain in GWei: 10527400045678272
|      â””â”€â”€ In GWei: 328981251427446
|           â””â”€â”€ In GNO: 328981.251427446
|  â””â”€â”€ Total unclaimed GNO balance by validators in wei: 5.864975406534933e+21
|       â””â”€â”€ Total unclaimed GNO balance by validators in GNO: 5864.9754065349325
â””â”€â”€ Deposit contract balance in GWei: -27662468085242.37
     â””â”€â”€ In GNO: -27662.46808524237
GNO distribution || Validators: 464775 rounded GNO holdings:number of validators {
  '0': 135701,
  '1': 323562,
  '0.99': 627,
  '0.98': 524,
  '0.9': 578,
  '0.89': 421,
  '0.93': 403,
  '0.92': 219,
  '0.91': 402,
  '1.4': 7,
  '0.97': 573,
  '0.82': 52,
  '1.37': 33,
  '1.36': 19,
  '1.38': 8,
  '1.39': 3,
  '1.35': 21,
  '0.81': 58,
  '1.3': 3,
  '0.88': 59,
  '0.95': 147,
  '1.15': 8,
  '0.94': 113,
  '1.41': 1,
  '1.21': 28,
  '0.86': 49,
  '1.07': 30,
  '1.31': 1,
  '0.87': 64,
  '1.22': 11,
  '0.75': 5,
  '1.02': 57,
  '0.79': 22,
  '1.2': 55,
  '0.96': 55,
  '0.76': 17,
  '1.34': 46,
  '0.84': 39,
  '0.77': 31,
  '0.8': 26,
  '1.29': 5,
  '1.04': 24,
  '1.19': 20,
  '0.78': 23,
  '1.14': 34,
  '1.23': 18,
  '1.13': 14,
  '0.83': 47,
  '0.85': 31,
  '1.27': 18,
  '1.28': 7,
  '1.26': 16,
  '1.06': 15,
  '1.33': 31,
  '1.32': 8,
  '1.24': 34,
  '1.03': 67,
  '1.09': 39,
  '1.1': 34,
  '1.08': 10,
  '1.25': 17,
  '1.12': 10,
  '1.18': 16,
  '1.01': 86,
  '1.17': 11,
  '1.16': 12,
  '1.11': 12,
  '1.05': 38
}
Unclaimed GNO distribution || 3502 | output format: Unclaimed GNO : number of wallets {
  '0': 2504,
  '1': 10,
  '4': 4,
  '7': 1,
  '87': 1,
  '0.2': 8,
  '1.79': 2,
  '0.3': 4,
  '26.1': 1,
  '34.86': 1,
  '2.25': 1,
  '0.06': 28,
  '6.99': 1,
  '0.6': 4,
  '0.68': 3,
  '0.12': 15,
  '0.13': 10,
  '0.37': 2,
  '3.67': 1,
  '2.92': 1,
  '2.91': 1,
  '30.51': 1,
  '2.29': 1,
  '3.06': 1,
  '17.78': 1,
  '344.55': 1,
  '5.53': 1,
  '8.78': 1,
  '1.08': 2,
  '0.43': 3,
  '0.08': 24,
  '0.46': 5,
  '9.52': 1,
  '2.84': 1,
  '1.54': 2,
  '0.92': 3,
  '0.28': 10,
  '0.04': 25,
  '1.92': 2,
  '1.88': 1,
  '12.62': 1,
  '0.26': 5,
  '0.11': 13,
  '0.31': 13,
  '0.41': 6,
  '0.44': 3,
  '0.62': 3,
  '3.97': 1,
  '0.61': 11,
  '52.15': 1,
  '1.73': 2,
  '0.02': 43,
  '24.14': 1,
  '1.19': 5,
  '0.7': 2,
  '0.81': 3,
  '5.01': 2,
  '0.1': 27,
  '0.23': 4,
  '0.05': 43,
  '0.93': 1,
  '0.64': 1,
  '2.12': 2,
  '2.86': 2,
  '0.48': 3,
  '1.53': 1,
  '1.55': 5,
  '0.75': 6,
  '1.39': 2,
  '2.09': 2,
  '0.36': 6,
  '1.69': 1,
  '38.03': 1,
  '0.73': 5,
  '1.12': 4,
  '1.5': 1,
  '0.95': 2,
  '1.11': 4,
  '2.02': 2,
  '1.07': 4,
  '0.4': 9,
  '1.28': 1,
  '0.32': 7,
  '3.94': 1,
  '361.68': 1,
  '0.53': 12,
  '2.08': 1,
  '0.22': 11,
  '0.17': 10,
  '2.35': 2,
  '0.21': 11,
  '1.84': 1,
  '3.99': 2,
  '0.03': 34,
  '1.62': 1,
  '19.56': 1,
  '6.95': 1,
  '0.09': 17,
  '9.98': 1,
  '0.52': 3,
  '5.98': 1,
  '6.88': 1,
  '14.96': 1,
  '4.08': 1,
  '1.06': 2,
  '64.54': 1,
  '1.1': 1,
  '0.19': 3,
  '1.42': 2,
  '8.59': 1,
  '5.78': 1,
  '2.88': 1,
  '19.14': 1,
  '17.85': 1,
  '56.63': 1,
  '13.9': 1,
  '0.51': 2,
  '1279.43': 1,
  '0.15': 24,
  '1.44': 3,
  '1.81': 1,
  '0.16': 16,
  '0.25': 5,
  '0.86': 1,
  '10.05': 1,
  '1.15': 3,
  '11.34': 1,
  '0.14': 16,
  '13.59': 1,
  '0.34': 4,
  '1.51': 2,
  '9.46': 2,
  '0.42': 6,
  '0.07': 16,
  '2.93': 1,
  '2.49': 1,
  '9.67': 1,
  '4.91': 1,
  '7.46': 1,
  '5.88': 1,
  '4.22': 1,
  '0.01': 72,
  '1.03': 1,
  '1.41': 1,
  '1.09': 2,
  '1.67': 2,
  '3.05': 1,
  '0.87': 4,
  '1.56': 2,
  '1.46': 1,
  '0.5': 4,
  '1.21': 1,
  '0.79': 1,
  '0.72': 3,
  '35.75': 1,
  '9.64': 1,
  '1.48': 1,
  '0.47': 5,
  '2.03': 1,
  '11.78': 1,
  '1.33': 2,
  '3.4': 1,
  '0.83': 2,
  '0.58': 4,
  '0.35': 5,
  '12.28': 1,
  '1.98': 1,
  '0.49': 4,
  '0.57': 6,
  '0.56': 7,
  '0.27': 6,
  '8.45': 1,
  '0.59': 6,
  '40.1': 1,
  '0.63': 4,
  '9.26': 1,
  '1.04': 1,
  '3.33': 1,
  '1.23': 1,
  '0.55': 4,
  '4.42': 1,
  '7.42': 1,
  '0.9': 4,
  '4.16': 1,
  '1.02': 2,
  '1.91': 1,
  '4.02': 1,
  '0.54': 3,
  '0.38': 4,
  '4.01': 1,
  '0.65': 2,
  '0.8': 1,
  '2.82': 1,
  '1.26': 2,
  '3.09': 2,
  '7.74': 1,
  '0.88': 1,
  '0.18': 3,
  '0.24': 6,
  '0.76': 3,
  '1.16': 1,
  '6.46': 1,
  '4.29': 1,
  '0.45': 3,
  '0.29': 2,
  '7.48': 1,
  '79.43': 1,
  '1.93': 1,
  '0.78': 1,
  '13.15': 1,
  '5.6': 1,
  '1.95': 1,
  '2.01': 2,
  '22.54': 1,
  '0.84': 1,
  '183.64': 1,
  '1.01': 1,
  '50.66': 1,
  '8.23': 1,
  '4.55': 2,
  '1.58': 2,
  '4.07': 1,
  '29.13': 1,
  '8.87': 1,
  '18.41': 1,
  '0.39': 3,
  '2.39': 1,
  '50.57': 1,
  '49.25': 1,
  '51.26': 1,
  '5.58': 1,
  '20.88': 1,
  '27.19': 1,
  '38.33': 1,
  '1.34': 1,
  '10.27': 1,
  '0.77': 1,
  '2.62': 1,
  '15.04': 1,
  '5.95': 1,
  '32.08': 1,
  '1.97': 1,
  '559.03': 1,
  '110.89': 1,
  '75.23': 1,
  '28.98': 1,
  '9.31': 1,
  '3.13': 1,
  '0.82': 2,
  '0.67': 2,
  '0.89': 1,
  '7.19': 1,
  '2.04': 1,
  '1.6': 1,
  '0.71': 1,
  '2.56': 1,
  '2.31': 1,
  '2.72': 1,
  '4.6': 1,
  '50.46': 1,
  '50.59': 1,
  '86.09': 1,
  '49.6': 1,
  '43.15': 1,
  '50.81': 1,
  '31.89': 1,
  '26.34': 1,
  '32.34': 1,
  '6.31': 1,
  '6.56': 1,
  '3.23': 1,
  '69.95': 1,
  '29.94': 1,
  '1.52': 1,
  '126.79': 1,
  '5.94': 1,
  '5.61': 1,
  '58.79': 1,
  '1.45': 1,
  '196.07': 1,
  '1.4': 1,
  '1.3': 1,
  '1.22': 1,
  '18.79': 1,
  '5.2': 1,
  '42.64': 1,
  '0.94': 1,
  '3.03': 1,
  '0.99': 1,
  '5.03': 1,
  '1.7': 1,
  '1.87': 1,
  '5.63': 1,
  '2.23': 1,
  '4.26': 1
}
```
- Object-based output. Attach callback listener of schema `error, response` for `Process` request from external script
```
2024-12-30T13:14:20.376Z process completed | Response object: {
  time: 1735564460376,
  epoch: 1207137,
  GNO_validators: 328981251427446,
  GNO_contract: 307183758748738.56,
  GNO_unclaimed: 5864975406534.933,
  bilance: -27662468085242.37,
  validators: 464775,
  beaconchain_distribution: {
    '0': 135701,
    '1': 323562,
    '0.99': 627,
    '0.98': 524,
    '0.9': 578,
    '0.89': 421,
    '0.93': 403,
    '0.92': 219,
    '0.91': 402,
    '1.4': 7,
    '0.97': 573,
    '0.82': 52,
    '1.37': 33,
    '1.36': 19,
    '1.38': 8,
    '1.39': 3,
    '1.35': 21,
    '0.81': 58,
    '1.3': 3,
    '0.88': 59,
    '0.95': 147,
    '1.15': 8,
    '0.94': 113,
    '1.41': 1,
    '1.21': 28,
    '0.86': 49,
    '1.07': 30,
    '1.31': 1,
    '0.87': 64,
    '1.22': 11,
    '0.75': 5,
    '1.02': 57,
    '0.79': 22,
    '1.2': 55,
    '0.96': 55,
    '0.76': 17,
    '1.34': 46,
    '0.84': 39,
    '0.77': 31,
    '0.8': 26,
    '1.29': 5,
    '1.04': 24,
    '1.19': 20,
    '0.78': 23,
    '1.14': 34,
    '1.23': 18,
    '1.13': 14,
    '0.83': 47,
    '0.85': 31,
    '1.27': 18,
    '1.28': 7,
    '1.26': 16,
    '1.06': 15,
    '1.33': 31,
    '1.32': 8,
    '1.24': 34,
    '1.03': 67,
    '1.09': 39,
    '1.1': 34,
    '1.08': 10,
    '1.25': 17,
    '1.12': 10,
    '1.18': 16,
    '1.01': 86,
    '1.17': 11,
    '1.16': 12,
    '1.11': 12,
    '1.05': 38
  },
  wallets: 3502,
  unclaimed_distribution: {
    '0': 2504,
    '1': 10,
    '4': 4,
    '7': 1,
    '87': 1,
    '0.2': 8,
    '1.79': 2,
    '0.3': 4,
    '26.1': 1,
    '34.86': 1,
    '2.25': 1,
    '0.06': 28,
    '6.99': 1,
    '0.6': 4,
    '0.68': 3,
    '0.12': 15,
    '0.13': 10,
    '0.37': 2,
    '3.67': 1,
    '2.92': 1,
    '2.91': 1,
    '30.51': 1,
    '2.29': 1,
    '3.06': 1,
    '17.78': 1,
    '344.55': 1,
    '5.53': 1,
    '8.78': 1,
    '1.08': 2,
    '0.43': 3,
    '0.08': 24,
    '0.46': 5,
    '9.52': 1,
    '2.84': 1,
    '1.54': 2,
    '0.92': 3,
    '0.28': 10,
    '0.04': 25,
    '1.92': 2,
    '1.88': 1,
    '12.62': 1,
    '0.26': 5,
    '0.11': 13,
    '0.31': 13,
    '0.41': 6,
    '0.44': 3,
    '0.62': 3,
    '3.97': 1,
    '0.61': 11,
    '52.15': 1,
    '1.73': 2,
    '0.02': 43,
    '24.14': 1,
    '1.19': 5,
    '0.7': 2,
    '0.81': 3,
    '5.01': 2,
    '0.1': 27,
    '0.23': 4,
    '0.05': 43,
    '0.93': 1,
    '0.64': 1,
    '2.12': 2,
    '2.86': 2,
    '0.48': 3,
    '1.53': 1,
    '1.55': 5,
    '0.75': 6,
    '1.39': 2,
    '2.09': 2,
    '0.36': 6,
    '1.69': 1,
    '38.03': 1,
    '0.73': 5,
    '1.12': 4,
    '1.5': 1,
    '0.95': 2,
    '1.11': 4,
    '2.02': 2,
    '1.07': 4,
    '0.4': 9,
    '1.28': 1,
    '0.32': 7,
    '3.94': 1,
    '361.68': 1,
    '0.53': 12,
    '2.08': 1,
    '0.22': 11,
    '0.17': 10,
    '2.35': 2,
    '0.21': 11,
    '1.84': 1,
    '3.99': 2,
    '0.03': 34,
    '1.62': 1,
    '19.56': 1,
    '6.95': 1,
    '0.09': 17,
    '9.98': 1,
    '0.52': 3,
    '5.98': 1,
    '6.88': 1,
    '14.96': 1,
    '4.08': 1,
    '1.06': 2,
    '64.54': 1,
    '1.1': 1,
    '0.19': 3,
    '1.42': 2,
    '8.59': 1,
    '5.78': 1,
    '2.88': 1,
    '19.14': 1,
    '17.85': 1,
    '56.63': 1,
    '13.9': 1,
    '0.51': 2,
    '1279.43': 1,
    '0.15': 24,
    '1.44': 3,
    '1.81': 1,
    '0.16': 16,
    '0.25': 5,
    '0.86': 1,
    '10.05': 1,
    '1.15': 3,
    '11.34': 1,
    '0.14': 16,
    '13.59': 1,
    '0.34': 4,
    '1.51': 2,
    '9.46': 2,
    '0.42': 6,
    '0.07': 16,
    '2.93': 1,
    '2.49': 1,
    '9.67': 1,
    '4.91': 1,
    '7.46': 1,
    '5.88': 1,
    '4.22': 1,
    '0.01': 72,
    '1.03': 1,
    '1.41': 1,
    '1.09': 2,
    '1.67': 2,
    '3.05': 1,
    '0.87': 4,
    '1.56': 2,
    '1.46': 1,
    '0.5': 4,
    '1.21': 1,
    '0.79': 1,
    '0.72': 3,
    '35.75': 1,
    '9.64': 1,
    '1.48': 1,
    '0.47': 5,
    '2.03': 1,
    '11.78': 1,
    '1.33': 2,
    '3.4': 1,
    '0.83': 2,
    '0.58': 4,
    '0.35': 5,
    '12.28': 1,
    '1.98': 1,
    '0.49': 4,
    '0.57': 6,
    '0.56': 7,
    '0.27': 6,
    '8.45': 1,
    '0.59': 6,
    '40.1': 1,
    '0.63': 4,
    '9.26': 1,
    '1.04': 1,
    '3.33': 1,
    '1.23': 1,
    '0.55': 4,
    '4.42': 1,
    '7.42': 1,
    '0.9': 4,
    '4.16': 1,
    '1.02': 2,
    '1.91': 1,
    '4.02': 1,
    '0.54': 3,
    '0.38': 4,
    '4.01': 1,
    '0.65': 2,
    '0.8': 1,
    '2.82': 1,
    '1.26': 2,
    '3.09': 2,
    '7.74': 1,
    '0.88': 1,
    '0.18': 3,
    '0.24': 6,
    '0.76': 3,
    '1.16': 1,
    '6.46': 1,
    '4.29': 1,
    '0.45': 3,
    '0.29': 2,
    '7.48': 1,
    '79.43': 1,
    '1.93': 1,
    '0.78': 1,
    '13.15': 1,
    '5.6': 1,
    '1.95': 1,
    '2.01': 2,
    '22.54': 1,
    '0.84': 1,
    '183.64': 1,
    '1.01': 1,
    '50.66': 1,
    '8.23': 1,
    '4.55': 2,
    '1.58': 2,
    '4.07': 1,
    '29.13': 1,
    '8.87': 1,
    '18.41': 1,
    '0.39': 3,
    '2.39': 1,
    '50.57': 1,
    '49.25': 1,
    '51.26': 1,
    '5.58': 1,
    '20.88': 1,
    '27.19': 1,
    '38.33': 1,
    '1.34': 1,
    '10.27': 1,
    '0.77': 1,
    '2.62': 1,
    '15.04': 1,
    '5.95': 1,
    '32.08': 1,
    '1.97': 1,
    '559.03': 1,
    '110.89': 1,
    '75.23': 1,
    '28.98': 1,
    '9.31': 1,
    '3.13': 1,
    '0.82': 2,
    '0.67': 2,
    '0.89': 1,
    '7.19': 1,
    '2.04': 1,
    '1.6': 1,
    '0.71': 1,
    '2.56': 1,
    '2.31': 1,
    '2.72': 1,
    '4.6': 1,
    '50.46': 1,
    '50.59': 1,
    '86.09': 1,
    '49.6': 1,
    '43.15': 1,
    '50.81': 1,
    '31.89': 1,
    '26.34': 1,
    '32.34': 1,
    '6.31': 1,
    '6.56': 1,
    '3.23': 1,
    '69.95': 1,
    '29.94': 1,
    '1.52': 1,
    '126.79': 1,
    '5.94': 1,
    '5.61': 1,
    '58.79': 1,
    '1.45': 1,
    '196.07': 1,
    '1.4': 1,
    '1.3': 1,
    '1.22': 1,
    '18.79': 1,
    '5.2': 1,
    '42.64': 1,
    '0.94': 1,
    '3.03': 1,
    '0.99': 1,
    '5.03': 1,
    '1.7': 1,
    '1.87': 1,
    '5.63': 1,
    '2.23': 1,
    '4.26': 1
  }
}
```
